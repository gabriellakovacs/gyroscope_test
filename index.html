<!doctype html>
<html>
<head>
    <title>gyroscope-test</title>
    <style>

    body {
        margin: 0;
        padding: 0;
    }

    html {
        overflow: hidden;
    }
    </style>

</head>
<body>
    <p id="alpha"></p>
    <p id="beta"></p>
    <p id="gamma"></p>

    <p id="euleralpha"></p>
    <p id="eulerbeta"></p>
    <p id="eulergamma"></p>
    <canvas id="canvas"></canvas>

    <script type="text/javascript" src="fulltilt.js"></script>
    <script>
    var canvas = document.getElementById('canvas');
    var c = canvas.getContext('2d');

    var viewportW = window.innerWidth;
    var viewportH = window.innerHeight;

    canvas.width = viewportW;
    canvas.height = viewportH;
    

    c.fillStyle = "#0055ff";
    c.fillRect(0,viewportH/2,viewportW,viewportH);

    function Point (x, y){

               this.x = x;
               this.y = y;
           }

    function Line (slope, p){
        this.slope = slope;
        this.constant = p.y - slope * p.x;
    }

    Line.prototype.getpY = function(pX) {
        return pX * this.slope + this.constant;

    };   



    function drawQuadrangle (p1, p2, p3, p4, color){
        c.fillStyle = color;
        c.beginPath();
        c.moveTo(p1.x, p1.y);
        c.lineTo(p2.x, p2.y);
        c.lineTo(p3.x, p3.y);
        c.lineTo(p4.x, p4.y);
        c.fill();
    }
    var quaternion;
      var matrix ;
      var euler ;

    var center = new Point(viewportW/2, viewportH/2);

//-----------------------------------------------------------------------------------------------------------------------------------------------
     // Create a new FULLTILT Promise for e.g. *compass*-based deviceorientation data
  var promise = new FULLTILT.getDeviceOrientation({ 'type': 'world' });

  // FULLTILT.DeviceOrientation instance placeholder
  var deviceOrientation;

  promise
    .then(function(controller) {
      // Store the returned FULLTILT.DeviceOrientation object
      deviceOrientation = controller;
    })
    .catch(function(message) {
      console.error(message);

      // Optionally set up fallback controls...
      // initManualControls();
    });

  (function draw() {

    // If we have a valid FULLTILT.DeviceOrientation object then use it
    if (deviceOrientation) {

      // Obtain the *screen-adjusted* normalized device rotation
      // as Quaternion, Rotation Matrix and Euler Angles objects
      // from our FULLTILT.DeviceOrientation object
      quaternion = deviceOrientation.getScreenAdjustedQuaternion();
      matrix = deviceOrientation.getScreenAdjustedMatrix();
      euler = deviceOrientation.getScreenAdjustedEuler();

      // Do something with our quaternion, matrix, euler objects...
      console.log(quaternion);
      console.log(matrix);
      console.log(euler.alpha);

      document.getElementById("euleralpha").innerHTML = "euler alpha   " + euler.alpha;
        document.getElementById("eulerbeta").innerHTML = "euler beta    " + euler.beta;
        document.getElementById("eulergamma").innerHTML = "euler gamma   " + euler.gamma;

    }

    // Execute function on each browser animation frame
    requestAnimationFrame(draw);

  })();



    window.ondeviceorientation = function(event) {

        // c.fillStyle = "#ffffff";
        // c.fillRect(0,0,viewportW,viewportH);

        alpha = Math.round(event.alpha);
        beta = Math.round(event.beta);
        gamma = Math.round(event.gamma);

        // var rotatedline = new Line(Math.tan(alpha/180 * Math.PI), center);

        document.getElementById("alpha").innerHTML = "alpha" + alpha;
        document.getElementById("beta").innerHTML = "beta" + beta;
        document.getElementById("gamma").innerHTML = "gamma" + gamma;
        
        // document.getElementById("gamma").innerHTML = "p1 (0, " + rotatedline.getpY(0) + ")  p2 (" + viewportW + ", " + rotatedline.getpY(viewportW) + ") p3 (" + viewportW + ", " + viewportH + ") p4 ( 0, " +  viewportH + ")";

        


        // var p1 = new Point(0, rotatedline.getpY(0));
        // var p2 = new Point(viewportW, rotatedline.getpY(viewportW));
        // var p3 = new Point(viewportW, viewportH);
        // var p4 = new Point(0, viewportH);

        // drawQuadrangle(p1, p2, p3, p4, "#0055ff");
    }


    </script>
</body>
</html>